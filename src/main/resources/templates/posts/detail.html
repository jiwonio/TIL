<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org" xmlns:sec="https://www.thymeleaf.org/thymeleaf-extras-springsecurity6">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title th:text="${post.title} + ' - TIL'">게시글 상세</title>
  <style>
    :root{color-scheme:light dark}
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;margin:0;background:#f6f7f9}
    header{position:sticky;top:0;background:#fff;border-bottom:1px solid #e9edf2;padding:12px 16px;display:flex;justify-content:space-between;align-items:center}
    .brand{font-weight:800;letter-spacing:.2px}
    .actions a,.actions form{margin-left:8px;display:inline-block}
    .btn{padding:8px 12px;border-radius:10px;border:1px solid #d9dee6;background:#fff;color:#0b1f44;font-weight:600;text-decoration:none}
    .btn.primary{background:#1f6feb;color:#fff;border-color:#1f6feb}
    main{max-width:900px;margin:24px auto;padding:0 16px}
    .card{background:#fff;border:1px solid #e9edf2;border-radius:14px;padding:18px}
    .title{font-size:22px;margin:0 0 6px}
    .meta{color:#667085;font-size:12px;display:flex;gap:8px;align-items:center;margin-bottom:12px}
    .content{white-space:pre-wrap;line-height:1.6}
    .section-title{font-size:16px;margin:24px 0 8px}
    .comment{background:#fff;border:1px solid #e9edf2;border-radius:12px;padding:12px;margin:10px 0}
    textarea{width:100%;min-height:100px;padding:12px;border:1px solid #e3e6eb;border-radius:10px;font-size:14px}
  </style>
</head>
<body>
<header>
  <div class="brand"><a th:href="@{/}" style="text-decoration:none;color:inherit">TIL</a></div>
  <div class="actions">
    <a class="btn" th:href="@{/login}" sec:authorize="isAnonymous()">로그인</a>
    <a class="btn" th:href="@{/auth/register}" sec:authorize="isAnonymous()">회원가입</a>
    <a class="btn" th:href="@{/posts}" >목록</a>
    <a class="btn primary" th:href="@{/posts/new}" sec:authorize="isAuthenticated()">새 글</a>
    <form th:action="@{/logout}" method="post" sec:authorize="isAuthenticated()" style="display:inline">
      <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
      <button type="submit" class="btn">로그아웃</button>
    </form>
  </div>
</header>
<main>
  <article class="card">
    <h1 class="title" th:text="${post.title}">제목</h1>
    <div class="meta">
      <span th:text="${post.type}">NORMAL</span>
      <span>·</span>
      <span th:text="${#temporals.format(post.createdAt, 'yyyy-MM-dd HH:mm')}">2025-01-01</span>
    </div>
    <div class="content" th:text="${post.content}">내용</div>

    <div style="margin-top:14px; display:flex; gap:8px;">
      <a class="btn" th:href="@{'/posts/' + ${post.id} + '/edit'}" sec:authorize="isAuthenticated()">수정</a>
      <form th:action="@{'/posts/' + ${post.id} + '/delete'}" method="post" sec:authorize="isAuthenticated()">
        <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
        <button type="submit" class="btn">삭제</button>
      </form>
    </div>
  </article>

  <section>
    <h2 class="section-title">댓글</h2>
    <div th:if="${#lists.isEmpty(comments)}" style="color:#667085;">아직 댓글이 없습니다.</div>
    <div th:each="c : ${comments}" class="comment" th:style="'margin-left:' + (${c.depth} * 16) + 'px'">
      <div class="meta">
        <span th:text="${#temporals.format(c.createdAt, 'yyyy-MM-dd HH:mm')}">2025-01-01</span>
        <span>· depth </span><span th:text="${c.depth}">0</span>
      </div>
      <div th:text="${c.content}">댓글 내용</div>
    </div>
  </section>

  <section sec:authorize="isAuthenticated()" class="card" style="margin-top:16px;">
    <h3 class="section-title" style="margin-top:0">댓글 작성</h3>
    <form th:action="@{'/posts/' + ${post.id} + '/comments'}" th:object="${commentRequest}" method="post">
      <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
      <input type="hidden" th:field="*{parentId}" />
      <div class="field">
        <textarea th:field="*{content}" placeholder="댓글을 입력하세요" required></textarea>
      </div>
      <button type="submit" class="btn primary">댓글 등록</button>
    </form>
  </section>
</main>
</body>
</html>