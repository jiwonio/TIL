<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org" xmlns:sec="https://www.thymeleaf.org/thymeleaf-extras-springsecurity6">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title th:text="${post} != null ? '게시글 수정 - TIL' : '새 게시글 - TIL'">게시글</title>
  <style>
    :root{color-scheme:light dark}
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;margin:0;background:#f6f7f9}
    header{position:sticky;top:0;background:#fff;border-bottom:1px solid #e9edf2;padding:12px 16px;display:flex;justify-content:space-between;align-items:center}
    .brand{font-weight:800;letter-spacing:.2px}
    .actions a,.actions form{margin-left:8px;display:inline-block}
    .btn{padding:8px 12px;border-radius:10px;border:1px solid #d9dee6;background:#fff;color:#0b1f44;font-weight:600;text-decoration:none}
    .btn.primary{background:#1f6feb;color:#fff;border-color:#1f6feb}
    main{max-width:900px;margin:24px auto;padding:0 16px}
    .card{background:#fff;border:1px solid #e9edf2;border-radius:14px;padding:18px}
    label{display:block;margin:12px 0 6px;color:#555;font-size:14px}
    input[type='text'], select, textarea{width:100%;padding:12px 14px;border:1px solid #e3e6eb;border-radius:10px;font-size:14px}
    textarea{min-height:220px;line-height:1.5}
    .row{display:flex;gap:8px;align-items:center;margin-top:16px}
  </style>
</head>
<body>
<header>
  <div class="brand"><a th:href="@{/}" style="text-decoration:none;color:inherit">TIL</a></div>
  <div class="actions">
    <a class="btn" th:href="@{/posts}">목록</a>
    <form th:action="@{/logout}" method="post" sec:authorize="isAuthenticated()" style="display:inline">
      <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
      <button type="submit" class="btn">로그아웃</button>
    </form>
  </div>
</header>
<main>
  <section class="card">
    <h1 style="margin:0 0 10px;font-size:20px" th:text="${post} != null ? '게시글 수정' : '새 게시글'"></h1>

    <!-- 새 글 작성 폼 -->
    <form th:if="${post} == null" th:action="@{/posts}" th:object="${postRequest}" method="post">
      <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />

      <label for="title_new">제목</label>
      <input id="title_new" type="text" th:field="*{title}" placeholder="제목을 입력하세요" required />

      <label for="content_new">내용</label>
      <textarea id="content_new" th:field="*{content}" placeholder="내용을 입력하세요" required></textarea>

      <div class="row">
        <div style="flex:1">
          <label for="type_new">유형</label>
          <select id="type_new" th:field="*{type}">
            <option th:each="t : ${types}" th:value="${t}" th:text="${t}"></option>
          </select>
        </div>
        <div style="flex:1">
          <label for="visibility_new">공개 범위</label>
          <select id="visibility_new" th:field="*{visibility}">
            <option th:each="v : ${visibilities}" th:value="${v}" th:text="${v}"></option>
          </select>
        </div>
      </div>

      <div class="row">
        <button type="submit" class="btn primary">저장</button>
        <a class="btn" th:href="@{/posts}">취소</a>
      </div>
    </form>

    <!-- 게시글 수정 폼 -->
    <form th:if="${post} != null" th:action="@{'/posts/' + ${post.id} + '/edit'}" th:object="${postRequest}" method="post">
      <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />

      <label for="title_edit">제목</label>
      <input id="title_edit" type="text" th:field="*{title}" placeholder="제목을 입력하세요" required />

      <label for="content_edit">내용</label>
      <textarea id="content_edit" th:field="*{content}" placeholder="내용을 입력하세요" required></textarea>

      <div class="row">
        <div style="flex:1">
          <label for="type_edit">유형</label>
          <select id="type_edit" th:field="*{type}">
            <option th:each="t : ${types}" th:value="${t}" th:text="${t}"></option>
          </select>
        </div>
        <div style="flex:1">
          <label for="visibility_edit">공개 범위</label>
          <select id="visibility_edit" th:field="*{visibility}">
            <option th:each="v : ${visibilities}" th:value="${v}" th:text="${v}"></option>
          </select>
        </div>
      </div>

      <div class="row">
        <button type="submit" class="btn primary">수정</button>
        <a class="btn" th:href="@{'/posts/' + ${post.id}}">취소</a>
      </div>
    </form>

  </section>
</main>
</body>
</html>